#!/bin/sh

directories="
$HOME/Projects/Personal
$HOME/Projects/Work
$HOME/Projects/Suckless
$HOME/.config
$HOME/.local/bin
$HOME/Nextcloud
$HOME/Documents
$HOME
"

if [ $# -eq 1 ]; then
    dir=$1
else
    if [ -z "$TERM" ]; then
        dir=$(find $directories -mindepth 1 -maxdepth 1 -follow -type d | tofi)
    else
        dir=$(find $directories -mindepth 1 -maxdepth 1 -follow -type d | fzf)
    fi
fi

if [ -z "$dir" ]; then
    exit 0
fi

session=$(basename "$dir" | tr . _)
tmux_running=$(pgrep tmux)
inside_tmux=$(if [ "$TERM_PROGRAM" = 'tmux' ]; then echo 'true'; else echo 'false'; fi)

if tmux has-session -t="$session" 2>/dev/null; then
    if [ "$inside_tmux" = 'true' ]; then
        command="tmux switch-client -t $session"
        exit 0
    fi
    command="tmux attach-session -t $session"
    exit 0
fi

tmux new-session -d -s "$session" -c "$dir"

if [ "$inside_tmux" = 'true' ]; then
    command="tmux switch-client -t $session"
else
    command="tmux attach-session -t $session"
fi

if [ -z "$TERM" ]; then
    foot -e "$command"
else
    eval "$command"
fi
